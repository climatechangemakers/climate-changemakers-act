image: openjdk:11.0.12

services:
  - docker:dind

variables:
  DOCKER_HOST: "tcp://docker:2375"
  DOCKER_TLS_CERTDIR: ""
  DOCKER_DRIVER: overlay2

stages: 
  - test
  - build 

before_script: 
  - export GRADLE_USER_HOME=`pwd`/backend/.gradle

cache:
  paths:
    - ./bakcned/.gradle/wrapper
    - ./backend/.gradle/caches

test-backend:
  stage: test
  script: 
    - cd backend
    - ./gradlew test
  only: 
    - trunk 
    - external_pull_requests

build-production-container:
  stage: build
  script: 
    - docker build .
  only: 
    - trunk 
    - external_pull_requests
